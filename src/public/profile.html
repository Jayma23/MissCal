<!DOCTYPE html>
<html lang="en">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="shortcut icon" href="/favicon.png" type="image/x-icon">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Miss Cal - My Profile</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
<button id="sidebarToggle" class="sidebar-toggle">â˜° </button>
<aside class="sidebar hidden" id="sidebar">
    <h3>Dashboard</h3>
    <ul>
        <li><a href="mainPage.html"><i class="fas fa-home"></i> Home</a></li>
        <li><a href="formPage.html"><i class="fas fa-user-plus"></i> Join the Pageant</a></li>
        <li><a href="vote.html"><i class="fas fa-vote-yea"></i> Vote</a></li>
        <li><a href="rule.html"><i class="fas fa-gavel"></i> Rules</a></li>
        <li><a href="profile.html" class="active"><i class="fas fa-user-circle"></i> My Profile</a></li>
        <li><a href="leaderBoard.html"><i class="fas fa-trophy"></i> Leader Board</a></li>

    </ul>
</aside>
<header class="main-header">
    <div class="container">
        <h1 class="title">My Profile</h1>
        <p class="subtitle">Your current profile information</p>
    </div>
</header>

<nav class="navbar">
    <ul>
        <li><a href="mainPage.html">Home</a></li>
        <li><a href="vote.html">Vote</a></li>
    </ul>
</nav>

<main class="profile-container">
    <div class="profile-tabs">
        <button class="tab-button active" data-tab="basicInfo">Basic Info</button>
        <button class="tab-button" data-tab="story">My Story</button>
        <button class="tab-button" data-tab="experience">Experience</button>
        <button class="tab-button" data-tab="social">Social Media</button>
    </div>

    <div id="basicInfo" class="tab-content active">
        <h2 class="section-title">Basic Information</h2>
        <div class="profile-card">
            <div class="profile-header">
                <div id="profileImage" class="profile-avatar">
                    <img src="default-profile.png" alt="Profile Photo">
                </div>
                <div class="profile-details">
                    <h3 id="name">Loading...</h3>
                    <p><span class="badge">Class of <span id="year">Loading...</span></span></p>
                </div>
            </div>
            <div class="profile-body">
                <p><i class="fas fa-graduation-cap"></i> <strong>Major:</strong> <span id="major">Loading...</span></p>
                <p><i class="fas fa-award"></i> <strong>GPA:</strong> <span id="gpa">Loading...</span></p>
                <p><i class="fas fa-quote-left"></i> <strong>Campaign Line:</strong> <span id="campaign_line">Loading...</span></p>
            </div>
        </div>
    </div>

    <div id="story" class="tab-content">
        <h2 class="section-title">My Story</h2>
        <div class="story-container">
            <p id="personal_story">Loading...</p>
        </div>
    </div>

    <div id="experience" class="tab-content">
        <h2 class="section-title">Experience & Organizations</h2>
        <div class="experience-container">
            <h3><i class="fas fa-briefcase"></i> Professional Experience</h3>
            <div id="experience-content" class="content-block">Loading...</div>

            <h3><i class="fas fa-users"></i> Organizations</h3>
            <div id="organizations-content" class="content-block">Loading...</div>
        </div>
    </div>

    <div id="social" class="tab-content">
        <h2 class="section-title">Social Media</h2>
        <div class="social-links-grid">
            <a id="instagram" href="#" target="_blank" class="social-link instagram">
                <i class="fab fa-instagram"></i> Instagram
            </a>
            <a id="linkedin" href="#" target="_blank" class="social-link linkedin">
                <i class="fab fa-linkedin"></i> LinkedIn
            </a>
            <a id="facebook" href="#" target="_blank" class="social-link facebook">
                <i class="fab fa-facebook"></i> Facebook
            </a>
            <a id="github" href="#" target="_blank" class="social-link github">
                <i class="fab fa-github"></i> GitHub
            </a>
            <a id="tiktok" href="#" target="_blank" class="social-link tiktok">
                <i class="fab fa-tiktok"></i> TikTok
            </a>
        </div>
    </div>

    <div class="edit-button-container">
        <a href="editProfile.html" class="cta-button"><i class="fas fa-edit"></i> Edit Profile</a>
    </div>
</main>

<footer class="footer">
    <p>&copy; 2024 College Life. All rights reserved.</p>
</footer>

<style>
    /* General Styles */
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #FDB515; /* California Gold */
        color: #333;
        transition: all 0.3s ease;
    }

    .container {
        width: 90%;
        margin: auto;
        max-width: 1200px;
        text-align: center;
    }

    /* Header */
    .main-header {
        background: #003262; /* Berkeley Blue */
        color: white;
        text-align: center;
        padding: 50px 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .main-header .title {
        font-family: 'Playfair Display', serif;
        font-size: 2.5rem;
        margin-bottom: 10px;
        animation: fadeIn 1s ease;
    }

    .main-header .subtitle {
        font-size: 1.2rem;
        opacity: 0.9;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* Navbar */
    .navbar {
        background: #003262;
        color: white;
        padding: 10px 0;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .navbar ul {
        list-style: none;
        padding: 0;
        display: flex;
        justify-content: center;
        margin: 0;
    }

    .navbar ul li {
        margin: 0 10px;
    }

    .navbar ul li a {
        color: #003262;
        background: #FDB515;
        text-decoration: none;
        padding: 10px 20px;
        border-radius: 5px;
        font-weight: bold;
        transition: all 0.3s ease;
    }

    .navbar ul li a:hover {
        background: #e0a814;
        transform: translateY(-2px);
    }

    /* Profile Container */
    .profile-container {
        padding: 30px 20px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        margin: 20px auto;
        max-width: 800px;
        animation: slideUp 0.5s ease;
    }

    @keyframes slideUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .profile-container h2 {
        color: #003262; /* Berkeley Blue */
        margin-bottom: 20px;
        position: relative;
        display: inline-block;
    }

    .profile-container h2::after {
        content: '';
        position: absolute;
        bottom: -5px;
        left: 0;
        width: 100%;
        height: 3px;
        background: #FDB515;
        transform: scaleX(0);
        transform-origin: left;
        transition: transform 0.3s ease;
    }

    .profile-container h2:hover::after {
        transform: scaleX(1);
    }

    /* Tabs */
    .profile-tabs {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        margin-bottom: 20px;
        gap: 5px;
    }

    .tab-button {
        background: #f0f0f0;
        border: none;
        padding: 10px 15px;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: bold;
        color: #003262;
    }

    .tab-button:hover {
        background: #e0e0e0;
    }

    .tab-button.active {
        background: #003262;
        color: white;
    }

    .tab-content {
        display: none;
        animation: fadeIn 0.5s ease;
    }

    .tab-content.active {
        display: block;
    }

    /* Profile Card */
    .profile-card {
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        overflow: hidden;
        border: 1px solid #eee;
    }

    .profile-header {
        display: flex;
        align-items: center;
        padding: 20px;
        background: #f9f9f9;
    }

    .profile-avatar {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        overflow: hidden;
        margin-right: 20px;
        border: 3px solid #FDB515;
    }

    .profile-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .profile-details {
        flex: 1;
    }

    .profile-details h3 {
        margin: 0 0 5px 0;
        color: #003262;
    }

    .badge {
        background: #FDB515;
        color: #003262;
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: bold;
    }

    .profile-body {
        padding: 20px;
    }

    .profile-body p {
        margin-bottom: 15px;
        line-height: 1.6;
    }

    .profile-body i {
        color: #003262;
        margin-right: 8px;
    }

    /* Story Container */
    .story-container {
        padding: 20px;
        background: #f9f9f9;
        border-radius: 10px;
        line-height: 1.8;
        border-left: 5px solid #FDB515;
    }

    /* Experience Container */
    .experience-container {
        padding: 0 10px;
    }

    .experience-container h3 {
        color: #003262;
        margin: 20px 0 10px;
        display: flex;
        align-items: center;
    }

    .experience-container h3 i {
        margin-right: 10px;
    }

    .content-block {
        background: #f9f9f9;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        line-height: 1.6;
    }

    /* Social Links */
    .social-links-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 15px;
        margin-top: 20px;
    }

    .social-link {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 15px;
        border-radius: 8px;
        color: white;
        text-decoration: none;
        font-weight: bold;
        transition: all 0.3s ease;
    }

    .social-link:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .social-link i {
        margin-right: 8px;
        font-size: 1.2rem;
    }

    .instagram { background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); }
    .linkedin { background: #0077b5; }
    .facebook { background: #3b5998; }
    .github { background: #333; }
    .tiktok { background: #000000; }
    .disabled-link { opacity: 0.6; cursor: not-allowed; }

    /* Edit Button */
    .edit-button-container {
        text-align: center;
        margin-top: 30px;
    }

    .cta-button {
        display: inline-block;
        background: #003262; /* Berkeley Blue */
        color: white;
        text-decoration: none;
        padding: 12px 25px;
        border-radius: 10px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: bold;
        transition: all 0.3s ease;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .cta-button:hover {
        background: #00254a;
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }

    .cta-button i {
        margin-right: 8px;
    }

    /* Footer */
    .footer {
        background: #003262; /* Berkeley Blue */
        color: white;
        text-align: center;
        padding: 15px 0;
        position: relative;
        bottom: 0;
        width: 100%;
        margin-top: 30px;
    }

    /* Sidebar */
    .sidebar {
        background: #003262; /* Berkeley Blue */
        color: white;
        padding: 40px 25px;
        width: 250px;
        height: 100vh;
        box-shadow: 2px 0 15px rgba(0, 0, 0, 0.2);
        position: fixed;
        top: 0;
        left: 0;
        transform: translateX(-100%);
        transition: transform 0.3s ease;
        z-index: 1000;
        overflow-y: auto;
    }

    .sidebar h3 {
        margin-bottom: 40px;
        font-size: 1.5rem;
        color: #FDB515; /* California Gold */
        text-align: center;
        position: relative;
    }

    .sidebar h3::after {
        content: '';
        position: absolute;
        bottom: -10px;
        left: 50%;
        transform: translateX(-50%);
        width: 50px;
        height: 3px;
        background: #FDB515;
    }

    .sidebar ul {
        list-style: none;
        padding: 0;
    }

    .sidebar ul li {
        margin: 15px 0;
    }

    .sidebar ul li a {
        color: white;
        text-decoration: none;
        padding: 12px;
        display: block;
        border-radius: 5px;
        transition: all 0.3s ease;
    }

    .sidebar ul li a:hover, .sidebar ul li a.active {
        background: #FDB515; /* California Gold */
        color: #003262; /* Berkeley Blue */
        transform: translateX(5px);
    }

    .sidebar ul li a i {
        margin-right: 10px;
        width: 20px;
        text-align: center;
    }

    .sidebar.hidden {
        transform: translateX(-100%);
    }

    .sidebar.show {
        transform: translateX(0);
    }

    /* Toggle Button */
    .sidebar-toggle {
        position: fixed;
        top: 20px;
        left: 20px;
        background: #FDB515;
        color: #003262;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        z-index: 1001;
        font-size: 1.2rem;
        transition: all 0.3s ease;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .sidebar-toggle:hover {
        background: #e0a814;
        transform: scale(1.05);
    }

    /* Loading animation */
    .loading-spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(0, 50, 98, 0.3);
        border-radius: 50%;
        border-top-color: #003262;
        animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* Animation for profile card */
    .profile-card.loaded {
        animation: cardPop 0.5s ease-out;
    }

    @keyframes cardPop {
        0% { transform: scale(0.95); opacity: 0.8; }
        50% { transform: scale(1.02); }
        100% { transform: scale(1); opacity: 1; }
    }

    /* Animation for tab switching */
    .tab-content {
        opacity: 0;
        transform: translateY(10px);
    }

    .tab-content.active {
        opacity: 1;
        transform: translateY(0);
        transition: opacity 0.3s ease, transform 0.3s ease;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        .profile-tabs {
            flex-direction: column;
            align-items: center;
        }

        .tab-button {
            width: 100%;
            margin-bottom: 5px;
        }

        .profile-header {
            flex-direction: column;
            text-align: center;
        }

        .profile-avatar {
            margin-right: 0;
            margin-bottom: 15px;
        }

        .social-links-grid {
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        }
    }
</style>

<script>
    // Sidebar Toggle
    const sidebar = document.getElementById("sidebar");
    const sidebarToggle = document.getElementById("sidebarToggle");

    sidebarToggle.addEventListener("click", () => {
        sidebar.classList.toggle("show");
    });

    // Close sidebar when clicking outside
    document.addEventListener("click", (event) => {
        if (!sidebar.contains(event.target) && event.target !== sidebarToggle) {
            sidebar.classList.remove("show");
        }
    });

    // Tab functionality
    const tabButtons = document.querySelectorAll(".tab-button");
    const tabContents = document.querySelectorAll(".tab-content");

    tabButtons.forEach(button => {
        button.addEventListener("click", () => {
            // Remove active class from all buttons and contents
            tabButtons.forEach(btn => btn.classList.remove("active"));
            tabContents.forEach(content => content.classList.remove("active"));

            // Add active class to clicked button and corresponding content
            button.classList.add("active");
            const tabId = button.getAttribute("data-tab");
            document.getElementById(tabId).classList.add("active");
        });
    });

    // Logout functionality
    document.getElementById("logoffButton").addEventListener("click", async () => {
        try {
            const response = await fetch("https://server1.misscal.net/logout", {
                method: "POST",
                credentials: "include",
            });

            if (response.ok) {
                // Remove user_id cookie manually (for frontend visibility)
                document.cookie = "user_id=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC;";

                alert("You have been logged out.");
                window.location.href = "sign-in.html";  // Redirect to login page
            } else {
                alert("Logoff failed. Please try again.");
            }
        } catch (error) {
            console.error("Error logging out:", error);
            alert("An error occurred while logging out.");
        }
    });

    // Fetch profile data using the new endpoint
    async function fetchProfileData() {
        try {
            // Show loading indicators
            document.getElementById("name").innerHTML = '<div class="loading-spinner"></div> Loading...';

            // Use the new endpoint that gets data for the current user based on cookie
            const response = await fetch("https://server1.misscal.net/getCurrentStudent", {
                method: "GET",
                credentials: "include"
            });

            if (response.status === 401) {
                // Not logged in
                alert("You need to log in to view your profile.");
                window.location.href = "sign-in.html";
                return;
            }

            if (!response.ok) {
                throw new Error(`Server responded with status: ${response.status}`);
            }

            const data = await response.json();

            // Update basic info fields
            document.getElementById("name").innerText = data.name || "Not provided";
            document.getElementById("major").innerText = data.major || "Not provided";
            document.getElementById("gpa").innerText = data.gpa || "Not provided";
            document.getElementById("year").innerText = data.year || "Not provided";
            document.getElementById("campaign_line").innerText = data.campaign_line || "Not provided";

            // Story tab
            document.getElementById("personal_story").innerText = data.personal_story || "No personal story provided yet.";

            // Experience tab
            document.getElementById("experience-content").innerText = data.experience || "No professional experience listed yet.";
            document.getElementById("organizations-content").innerText = data.organizations || "No organizations listed yet.";

            // Update social links
            const socialPlatforms = ["instagram", "linkedin", "facebook", "github", "tiktok"];
            socialPlatforms.forEach((platform) => {
                const linkElement = document.getElementById(platform);
                if (!linkElement) return;

                const url = data[platform] || "#";

                // Only show "Not provided" text for non-clickable links
                if (url === "#") {
                    linkElement.innerHTML = `<i class="fab fa-${platform}"></i> Not provided`;
                    linkElement.classList.add("disabled-link");
                    linkElement.removeAttribute("href");
                    linkElement.style.pointerEvents = "none";
                } else {
                    linkElement.innerHTML = `<i class="fab fa-${platform}"></i> ${platform.charAt(0).toUpperCase() + platform.slice(1)}`;
                    linkElement.href = url.startsWith("http") ? url : `https://${url}`;
                    linkElement.classList.remove("disabled-link");
                    linkElement.style.pointerEvents = "auto";
                }
            });



            // Handle profile photo
            const profileImg = document.querySelector("#profileImage img");


            profileImg.src = `${data.photo}`;


// Optional: fallback if image fails to load
            profileImg.onerror = function () {
                this.src = "default-profile.png";
            };

            // Add animation to profile card after data is loaded
            document.querySelector(".profile-card").classList.add("loaded");

        } catch (error) {
            console.error("Error fetching profile data:", error);
            // Display error message to user
            document.getElementById("name").innerText = "Error loading profile";
            document.getElementById("major").innerText = "Could not connect to server";

            // Show error message
            const profileCard = document.querySelector(".profile-card");
            profileCard.style.borderColor = "#ff3860";

            const errorMsg = document.createElement("div");
            errorMsg.className = "error-message";
            errorMsg.innerHTML = `<p style="color: #ff3860; text-align: center; padding: 10px;">
                <i class="fas fa-exclamation-triangle"></i> Failed to load your profile data. Please try again later.
            </p>`;

            profileCard.appendChild(errorMsg);
        }
    }

    // Add visual feedback on interactive elements
    document.querySelectorAll(".tab-button, .social-link, .cta-button").forEach(elem => {
        elem.addEventListener("mousedown", function() {
            this.style.transform = "scale(0.95)";
        });

        elem.addEventListener("mouseup", function() {
            this.style.transform = "";
        });

        elem.addEventListener("mouseleave", function() {
            this.style.transform = "";
        });
    });

    // Load profile data on page load
    document.addEventListener("DOMContentLoaded", function() {
        fetchProfileData();
    });
</script>
</body>
</html>